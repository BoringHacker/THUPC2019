# Game  题目解法

## 第一部分

>  Prop 1. 最一般情况下先手必胜当且仅当 $N=P^k$，这个条件的必要性可以用数论知识，考虑同余关系得出。

对给定的 $N$，我们把 $N$ 写成 $N=P^k\cdot s$ 其中 $(s,P)=1$，那么上述命题的推论只有 $S[i]\equiv S[i+P^k]$ 的时候，先手才可能必胜。以下考虑 $N=P^k$ 的情况。

我们在 $\mathbb{Z}_p$ 上构造一个 $P^k\times P^k$ 的矩阵 $A$ 如下：

* $A(0, 0)=1, A(0, i)=0, \forall i > 0$.
* $A(i, j)=A(i - 1, j - 1) - A(i - 1, j)$，那么一个观察是 $A(i,j)\equiv (-1)^{i-j} {i\choose j}$ .

对给定的序列 $S$，把它写成列向量，求解方程：
$$
Ax = S,
$$

>  Prop 2. 上述方程得到解 $x$，我们找到最小的 $i$ 使得 $x_i\not\equiv 0$，那么 $P^k-i$ 即为答案。（这里下标均为 $0$ 打头）

使用二项式反演的知识，上述方程等价于：
$$
x=A^{-1}S,
$$
而：
$$
A^{-1}(i, j) = C(i, j).
$$

所以对向量 $S$ 做二项式变换得到 $x$，暴力是 $N^2$ ，使用 FFT **不可以** $N\log N$，因为在 mod P 下做运算不能简单地把二项式系数贡献拆开。

因此我们想法是这样的：因为上述运算都是在 $\mathbb{Z}_p$ 上进行的，Lucas 定理告诉我们 $S_i$ 对 $A_j$ 有贡献当且仅当 $i$ 在 $p$ 进制下每一位大于等于 $j$ ，那么使用 Mobius 变换类似的方法即可在 $O(NP\log N)$ 时间解决，但是这样做的常数是小的。

## 第二部分

如果我有时间的话，将来会在这里写下对上面的几个关键命题的证明。
